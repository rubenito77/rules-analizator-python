<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kie Server Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 20px; }
table { border-collapse: collapse; width: 100%; margin-bottom: 30px; background: #fff; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background: #333; color: #fff; }
h2 { margin-top: 40px; color: #333; }
.highlight { background-color: #ddd; }
</style>
</head>
<body>

<h1>Kie Server Dashboard</h1>
<p>Última actualización: {{ timestamp }}</p>

{% for pod_name, r in kieservers.items() %}
    <h2>{{ pod_name }} - Pool: {{ r.pool }} (Duración: {{ r.duracion }})</h2>

    <canvas id="chart-{{ pod_name }}" style="max-width: 800px;"></canvas>

    <table>
        <tr>
            <th>Regla</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Threads</th>
        </tr>
        {% for regla in r.reglas %}
        <tr class="{% if regla.nombre == r.regla_mas_larga.nombre %}highlight{% endif %}">
            <td>{{ regla.nombre }}</td>
            <td>{{ regla.inicio }}</td>
            <td>{{ regla.fin }}</td>
            <td>
                {% for thread, count in regla.threads.items() %}
                    {{ thread }}: {{ count }}<br>
                {% endfor %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <script>
        const ctx{{ pod_name|replace('-', '_') }} = document.getElementById('chart-{{ pod_name }}').getContext('2d');
        const labels{{ pod_name|replace('-', '_') }} = [{% for regla in r.reglas %}'{{ regla.nombre }}',{% endfor %}];
        const data{{ pod_name|replace('-', '_') }} = [{% for regla in r.reglas %}{{ regla.duracion_segundos }},{% endfor %}];
        new Chart(ctx{{ pod_name|replace('-', '_') }}, {
            type: 'bar',
            data: {
                labels: labels{{ pod_name|replace('-', '_') }},
                datasets: [{
                    label: 'Duración (segundos)',
                    data: data{{ pod_name|replace('-', '_') }},
                    backgroundColor: 'rgba(54, 162, 235, 0.6)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true } }
            }
        });
    </script>

{% endfor %}

</body>
</html>

